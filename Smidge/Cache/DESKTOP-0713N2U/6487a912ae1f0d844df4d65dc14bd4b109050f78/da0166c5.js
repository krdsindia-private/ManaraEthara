function configurationController($scope,notificationsService,umbracoCmsIntegrationsCrmDynamicsResource){function getAccessToken(event){event.data.type==="dynamics:oauth:success"&&umbracoCmsIntegrationsCrmDynamicsResource.getAccessToken(event.data.code).then(function(response){response.startsWith("Error:")?typeof $scope.connected=="undefined"&&notificationsService.error("Dynamics Configuration",response):(vm.oauthConfig.isConnected=!0,typeof $scope.connected=="undefined"&&notificationsService.success("Dynamics Configuration","OAuth connected."),umbracoCmsIntegrationsCrmDynamicsResource.getSystemUserFullName().then(function(response){vm.oauthConfig.fullName=response}),typeof $scope.connected=="function"&&$scope.connected())})}var vm=this;vm.oauthInitialized=!1;vm.oauthConfig={};umbracoCmsIntegrationsCrmDynamicsResource.checkOAuthConfiguration().then(function(response){response&&response.isAuthorized?(vm.oauthConfig.isConnected=!0,vm.oauthConfig.fullName=response.fullName,typeof $scope.connected=="function"&&$scope.connected()):response.message.length>0&&typeof $scope.connected=="undefined"&&notificationsService.error("Dynamics Configuration",response.message)}).finally(function(){vm.oauthInitialized=!0});vm.onConnectClick=function(){window.addEventListener("message",getAccessToken,!1);umbracoCmsIntegrationsCrmDynamicsResource.getAuthorizationUrl().then(function(response){vm.authWindow=window.open(response,"Authorize","width=900,height=700,modal=yes,alwaysRaised=yes")})};vm.onRevokeToken=function(){umbracoCmsIntegrationsCrmDynamicsResource.revokeAccessToken().then(function(){vm.oauthConfig.isConnected=!1;typeof $scope.connected=="undefined"&&notificationsService.success("Dynamics Configuration","OAuth connection revoked.");typeof $scope.revoked=="function"&&$scope.revoked();window.removeEventListener("message",getAccessToken)})}}angular.module("umbraco").controller("Umbraco.Cms.Integrations.Crm.Dynamics.ConfigurationController",configurationController)