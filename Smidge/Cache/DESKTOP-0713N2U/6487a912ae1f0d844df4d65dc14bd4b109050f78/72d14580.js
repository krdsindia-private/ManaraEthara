function formPickerController($scope,editorService,notificationsService,umbracoCmsIntegrationsCrmDynamicsResource){function loadForms(){vm.loading=!0;vm.formsLoading=!0;umbracoCmsIntegrationsCrmDynamicsResource.getForms().then(function(response){vm.dynamicsFormsList=[];response&&response.value.forEach(item=>{vm.dynamicsFormsList.push({id:item.msdyncrm_marketingformid,name:item.msdyncrm_name,embedCode:"",iframeEmbedded:vm.iframeEmbedded})})}).finally(function(){vm.loading=!1;vm.formsLoading=!1})}var vm=this;vm.loading=!1;vm.searchTerm="";vm.selectedForm={};vm.iframeEmbedded=!1;vm.isConnected=!1;vm.formsLoading=!0;umbracoCmsIntegrationsCrmDynamicsResource.checkOAuthConfiguration().then(function(response){if(!response.isAuthorized){let error="Unable to connect to Dynamics. Please review the settings of the form picker property's data type.";notificationsService.error("Dynamics API",error);vm.error=error}});vm.saveForm=function(form){umbracoCmsIntegrationsCrmDynamicsResource.getEmbedCode(form.id).then(function(response){response.length==0&&notificationsService.warning("Dynamics API","Unable to embed selected form. Please check if it is live.");form.embedCode=response;$scope.model.value=form})};vm.removeForm=function(){$scope.model.value=null};vm.toggleRenderMode=function(){vm.iframeEmbedded=!vm.iframeEmbedded};vm.openDynamicsFormPickerOverlay=function(){var options={title:"Dynamics - Marketing Forms",subtitle:"Select a form",view:"/App_Plugins/UmbracoCms.Integrations/Crm/Dynamics/views/formpickereditor.html",size:"medium",selectForm:function(form,iframeEmbedded){form.id!==undefined&&(form.iframeEmbedded=iframeEmbedded,vm.saveForm(form));editorService.close()},close:function(){editorService.close()}};editorService.open(options)};$scope.connected=function(){vm.isConnected=!0;loadForms()};$scope.revoked=function(){vm.isConnected=!1;vm.dynamicsFormsList=[]}}angular.module("umbraco").controller("Umbraco.Cms.Integrations.Crm.Dynamics.FormPickerController",formPickerController)